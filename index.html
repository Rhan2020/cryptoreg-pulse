<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ðŸŒ° CryptoReg Pulse â€” Regulatory Intelligence Brief</title>
  <style>
    :root {
      --bg: #0d1117;
      --surface: #161b22;
      --border: #30363d;
      --text: #e6edf3;
      --text-muted: #8b949e;
      --accent: #58a6ff;
      --critical: #f85149;
      --high: #d29922;
      --medium: #58a6ff;
      --low: #3fb950;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      min-height: 100vh;
    }
    .container { max-width: 1100px; margin: 0 auto; padding: 2rem 1.5rem; }

    /* ðŸŒ° Header */
    header {
      text-align: center;
      margin-bottom: 2.5rem;
      padding-bottom: 1.5rem;
      border-bottom: 1px solid var(--border);
    }
    header h1 {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }
    header p {
      color: var(--text-muted);
      font-size: 1rem;
    }
    .update-time {
      color: var(--text-muted);
      font-size: 0.85rem;
      margin-top: 0.5rem;
    }

    /* ðŸŒ° Stats Grid */
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }
    .stat-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1.2rem;
      text-align: center;
    }
    .stat-card .number {
      font-size: 2rem;
      font-weight: 700;
      display: block;
    }
    .stat-card .label {
      color: var(--text-muted);
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .stat-card.critical .number { color: var(--critical); }
    .stat-card.high .number { color: var(--high); }
    .stat-card.medium .number { color: var(--medium); }
    .stat-card.low .number { color: var(--low); }

    /* ðŸŒ° AI Analysis Section */
    .analysis {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 2rem;
    }
    .analysis h2 {
      font-size: 1.2rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .risk-badge {
      display: inline-block;
      padding: 0.2rem 0.7rem;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }
    .risk-badge.critical { background: rgba(248,81,73,0.2); color: var(--critical); }
    .risk-badge.high { background: rgba(210,153,34,0.2); color: var(--high); }
    .risk-badge.elevated { background: rgba(210,153,34,0.2); color: var(--high); }
    .risk-badge.medium { background: rgba(88,166,255,0.2); color: var(--medium); }
    .risk-badge.low { background: rgba(63,185,80,0.2); color: var(--low); }
    .analysis-summary {
      color: var(--text-muted);
      margin-bottom: 1rem;
      font-size: 0.95rem;
    }
    .analysis-list {
      list-style: none;
      padding: 0;
    }
    .analysis-list li {
      padding: 0.4rem 0;
      color: var(--text-muted);
      font-size: 0.9rem;
    }
    .analysis-list li::before {
      content: "â†’ ";
      color: var(--accent);
    }

    /* ðŸŒ° Filters */
    .filters {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 1.5rem;
    }
    .filter-btn {
      background: var(--surface);
      border: 1px solid var(--border);
      color: var(--text-muted);
      padding: 0.4rem 0.9rem;
      border-radius: 20px;
      cursor: pointer;
      font-size: 0.85rem;
      transition: all 0.2s;
    }
    .filter-btn:hover, .filter-btn.active {
      border-color: var(--accent);
      color: var(--accent);
    }

    /* ðŸŒ° Event Cards */
    .events { display: flex; flex-direction: column; gap: 1rem; }
    .event-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1.2rem 1.2rem 1.2rem 1.5rem;
      border-left: 4px solid var(--border);
      transition: border-color 0.2s;
    }
    .event-card:hover { border-color: var(--accent); border-left-color: inherit; }
    .event-card.severity-critical { border-left-color: var(--critical); }
    .event-card.severity-high { border-left-color: var(--high); }
    .event-card.severity-medium { border-left-color: var(--medium); }
    .event-card.severity-low { border-left-color: var(--low); }

    .event-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.6rem;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    .event-entity {
      font-weight: 600;
      font-size: 1rem;
    }
    .event-meta {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      flex-wrap: wrap;
    }
    .tag {
      display: inline-block;
      padding: 0.15rem 0.5rem;
      border-radius: 10px;
      font-size: 0.7rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.03em;
    }
    .tag-severity { border: 1px solid; }
    .tag-severity.critical { color: var(--critical); border-color: var(--critical); }
    .tag-severity.high { color: var(--high); border-color: var(--high); }
    .tag-severity.medium { color: var(--medium); border-color: var(--medium); }
    .tag-severity.low { color: var(--low); border-color: var(--low); }
    .tag-jurisdiction {
      background: rgba(88,166,255,0.1);
      color: var(--accent);
    }
    .tag-category {
      background: rgba(139,148,158,0.15);
      color: var(--text-muted);
    }
    .event-description {
      color: var(--text-muted);
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
    }
    .event-footer {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      color: var(--text-muted);
      opacity: 0.7;
    }

    /* ðŸŒ° Jurisdiction Chart */
    .jurisdiction-chart {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1.5rem;
      margin-bottom: 2rem;
    }
    .jurisdiction-chart h2 {
      font-size: 1.2rem;
      margin-bottom: 1rem;
    }
    .bar-row {
      display: flex;
      align-items: center;
      margin-bottom: 0.6rem;
      gap: 0.8rem;
    }
    .bar-label {
      min-width: 120px;
      font-size: 0.85rem;
      color: var(--text-muted);
      text-align: right;
    }
    .bar-track {
      flex: 1;
      height: 22px;
      background: rgba(88,166,255,0.08);
      border-radius: 4px;
      overflow: hidden;
    }
    .bar-fill {
      height: 100%;
      background: var(--accent);
      border-radius: 4px;
      display: flex;
      align-items: center;
      padding-left: 0.5rem;
      font-size: 0.75rem;
      font-weight: 600;
      min-width: 24px;
      transition: width 0.5s ease;
    }

    /* ðŸŒ° Footer */
    footer {
      text-align: center;
      padding: 2rem 0 1rem;
      border-top: 1px solid var(--border);
      margin-top: 2rem;
      color: var(--text-muted);
      font-size: 0.85rem;
    }
    footer a { color: var(--accent); text-decoration: none; }
    footer a:hover { text-decoration: underline; }

    /* ðŸŒ° Responsive */
    @media (max-width: 600px) {
      .container { padding: 1rem; }
      header h1 { font-size: 1.5rem; }
      .stats { grid-template-columns: repeat(2, 1fr); }
      .bar-label { min-width: 80px; font-size: 0.75rem; }
    }

    .no-events {
      text-align: center;
      padding: 3rem;
      color: var(--text-muted);
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ðŸŒ° Header -->
    <header>
      <h1>ðŸŒ° CryptoReg Pulse</h1>
      <p>Weekly Crypto Regulatory Intelligence Brief</p>
      <div class="update-time" id="updateTime">Loading...</div>
    </header>

    <!-- ðŸŒ° Stats -->
    <div class="stats" id="stats"></div>

    <!-- ðŸŒ° AI Analysis -->
    <div class="analysis" id="analysis" style="display:none">
      <h2>ðŸŒ° AI Regulatory Assessment</h2>
      <div id="analysisContent"></div>
    </div>

    <!-- ðŸŒ° Jurisdiction Breakdown -->
    <div class="jurisdiction-chart" id="jurisdictionChart">
      <h2>ðŸŒ° Jurisdiction Activity</h2>
      <div id="jurisdictionBars"></div>
    </div>

    <!-- ðŸŒ° Filters -->
    <div class="filters" id="filters"></div>

    <!-- ðŸŒ° Events -->
    <div class="events" id="events">
      <div class="no-events">Loading regulatory events... ðŸŒ°</div>
    </div>

    <!-- ðŸŒ° Footer -->
    <footer>
      <p>ðŸŒ° CryptoReg Pulse â€” Built on <a href="https://github.com/1712n/product-kit-template">Product Kit Template</a> ðŸŒ°</p>
      <p>Data sourced from <a href="https://rapidapi.com/CPWatch/api/cpw-tracker">CPW Tracker API</a> â€¢ Updated weekly ðŸŒ°</p>
    </footer>
  </div>

  <script>
    // ðŸŒ° CryptoReg Pulse Dashboard Logic ðŸŒ°
    let allEvents = []
    let currentFilter = "all"

    async function loadData() {
      try {
        const res = await fetch("data/events.json")
        const data = await res.json()

        // Handle both formats: array or {analysis, events} ðŸŒ°
        if (Array.isArray(data)) {
          allEvents = data
          renderDashboard(null)
        } else {
          allEvents = data.events || []
          renderDashboard(data.analysis || null)
          if (data.generated_at) {
            document.getElementById("updateTime").textContent =
              `Last updated: ${new Date(data.generated_at).toLocaleString()}`
          }
        }
      } catch (err) {
        document.getElementById("events").innerHTML =
          '<div class="no-events">Failed to load data ðŸŒ°</div>'
      }
    }

    function renderDashboard(analysis) {
      renderStats()
      renderAnalysis(analysis)
      renderJurisdictions()
      renderFilters()
      renderEvents()

      if (!analysis) {
        const latest = allEvents[0]
        if (latest?.timestamp) {
          document.getElementById("updateTime").textContent =
            `Latest event: ${new Date(latest.timestamp).toLocaleDateString()}`
        }
      }
    }

    // ðŸŒ° Stats
    function renderStats() {
      const counts = { total: allEvents.length, critical: 0, high: 0, medium: 0, low: 0 }
      allEvents.forEach(e => { if (counts[e.severity] !== undefined) counts[e.severity]++ })

      document.getElementById("stats").innerHTML = `
        <div class="stat-card"><span class="number">${counts.total}</span><span class="label">Total Events</span></div>
        <div class="stat-card critical"><span class="number">${counts.critical}</span><span class="label">Critical</span></div>
        <div class="stat-card high"><span class="number">${counts.high}</span><span class="label">High</span></div>
        <div class="stat-card medium"><span class="number">${counts.medium}</span><span class="label">Medium</span></div>
        <div class="stat-card low"><span class="number">${counts.low}</span><span class="label">Low</span></div>
      `
    }

    // ðŸŒ° AI Analysis
    function renderAnalysis(analysis) {
      if (!analysis) return
      const el = document.getElementById("analysis")
      el.style.display = "block"

      let html = `<span class="risk-badge ${analysis.risk_level}">${analysis.risk_level} risk</span>`
      if (analysis.summary) html += `<p class="analysis-summary">${analysis.summary}</p>`
      if (analysis.trends?.length) {
        html += '<ul class="analysis-list">'
        analysis.trends.forEach(t => html += `<li>${t}</li>`)
        html += "</ul>"
      }
      if (analysis.outlook) html += `<p class="analysis-summary" style="margin-top:0.8rem;font-style:italic">${analysis.outlook}</p>`

      document.getElementById("analysisContent").innerHTML = html
    }

    // ðŸŒ° Jurisdiction Chart
    function renderJurisdictions() {
      const counts = {}
      allEvents.forEach(e => {
        const j = e.jurisdiction || "Other"
        counts[j] = (counts[j] || 0) + 1
      })

      const sorted = Object.entries(counts).sort((a, b) => b[1] - a[1])
      const max = sorted[0]?.[1] || 1

      document.getElementById("jurisdictionBars").innerHTML = sorted
        .map(([name, count]) => `
          <div class="bar-row">
            <span class="bar-label">${name}</span>
            <div class="bar-track">
              <div class="bar-fill" style="width:${(count / max) * 100}%">${count}</div>
            </div>
          </div>
        `).join("")
    }

    // ðŸŒ° Filters
    function renderFilters() {
      const categories = ["all", ...new Set(allEvents.map(e => e.category).filter(Boolean))]
      document.getElementById("filters").innerHTML = categories
        .map(c => `<button class="filter-btn ${c === currentFilter ? "active" : ""}" onclick="setFilter('${c}')">${c === "all" ? "All Events" : c}</button>`)
        .join("")
    }

    function setFilter(f) {
      currentFilter = f
      renderFilters()
      renderEvents()
    }

    // ðŸŒ° Event Cards
    function renderEvents() {
      const filtered = currentFilter === "all"
        ? allEvents
        : allEvents.filter(e => e.category === currentFilter)

      if (filtered.length === 0) {
        document.getElementById("events").innerHTML = '<div class="no-events">No events match this filter ðŸŒ°</div>'
        return
      }

      document.getElementById("events").innerHTML = filtered.map(e => `
        <div class="event-card severity-${e.severity || "low"}">
          <div class="event-header">
            <span class="event-entity">${e.entity || "Unknown"}</span>
            <div class="event-meta">
              <span class="tag tag-severity ${e.severity || "low"}">${(e.severity || "low").toUpperCase()}</span>
              ${e.jurisdiction ? `<span class="tag tag-jurisdiction">${e.jurisdiction}</span>` : ""}
              ${e.category ? `<span class="tag tag-category">${e.category}</span>` : ""}
            </div>
          </div>
          <p class="event-description">${e.description || "No description available"}</p>
          <div class="event-footer">
            <span>${e.source || ""}</span>
            <span>${e.timestamp ? new Date(e.timestamp).toLocaleDateString() : ""}</span>
          </div>
        </div>
      `).join("")
    }

    // ðŸŒ° Initialize
    loadData()
  </script>
</body>
</html>
